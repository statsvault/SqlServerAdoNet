ä
>C:\Projects\SqlServerAdoNet\SqlServerAdoNet\Enums\QueryType.cs
	namespace 	
	StatKings
 
. 
SqlServerAdoNet #
{ 
public 

enum 
	QueryType 
{ 
Select 
, 
Insert 
, 
Update 
, 
Delete 
}		 
}

 ∑
RC:\Projects\SqlServerAdoNet\SqlServerAdoNet\Exceptions\CommandSettingsException.cs
	namespace 	
	StatKings
 
. 
SqlServerAdoNet #
{ 
[ 
Serializable 
] 
public 

class $
CommandSettingsException )
:* +
	Exception, 5
{ 
public $
CommandSettingsException '
(' (
)( )
:* +
base, 0
(0 1
)1 2
{3 4
}5 6
public

 $
CommandSettingsException

 '
(

' (
string

( .
message

/ 6
)

6 7
:

8 9
base

: >
(

> ?
message

? F
)

F G
{

H I
}

J K
} 
} ∑
RC:\Projects\SqlServerAdoNet\SqlServerAdoNet\Exceptions\ModelDefinitionException.cs
	namespace 	
	StatKings
 
. 
SqlServerAdoNet #
{ 
[ 
Serializable 
] 
public 

class $
ModelDefinitionException )
:* +
	Exception, 5
{ 
public $
ModelDefinitionException '
(' (
)( )
:* +
base, 0
(0 1
)1 2
{3 4
}5 6
public

 $
ModelDefinitionException

 '
(

' (
string

( .
message

/ 6
)

6 7
:

8 9
base

: >
(

> ?
message

? F
)

F G
{

H I
}

J K
} 
} £
MC:\Projects\SqlServerAdoNet\SqlServerAdoNet\Exceptions\SqlBuilderException.cs
	namespace 	
	StatKings
 
. 
SqlServerAdoNet #
{ 
[ 
Serializable 
] 
public 

class 
SqlBuilderException $
:% &
	Exception' 0
{ 
public 
SqlBuilderException "
(" #
)# $
:% &
base' +
(+ ,
), -
{. /
}0 1
public

 
SqlBuilderException

 "
(

" #
string

# )
message

* 1
)

1 2
:

3 4
base

5 9
(

9 :
message

: A
)

A B
{

C D
}

E F
} 
} É
CC:\Projects\SqlServerAdoNet\SqlServerAdoNet\Helpers\CommonHelper.cs
	namespace 	
	StatKings
 
. 
SqlServerAdoNet #
{ 
internal 
static 
class 
CommonHelper &
{ 
public 
static 
string 
ReplaceInsensitive /
(/ 0
this0 4
string5 ;
stringToSearch< J
,J K
stringL R
oldValueS [
,[ \
string] c
newValued l
)l m
{ 	
if 
( 
! 
string 
. 
IsNullOrEmpty %
(% &
stringToSearch& 4
)4 5
&&6 8
!9 :
string: @
.@ A
IsNullOrEmptyA N
(N O
oldValueO W
)W X
&&Y [
newValue\ d
!=e g
nullh l
)l m
{ 
return 
Regex 
. 
Replace $
($ %
stringToSearch% 3
,3 4
Regex5 :
.: ;
Escape; A
(A B
oldValueB J
)J K
,K L
newValueM U
.U V
ReplaceV ]
(] ^
$str^ a
,a b
$strc g
)g h
,h i
RegexOptionsj v
.v w

IgnoreCase	w Å
)
Å Ç
;
Ç É
} 
return 
stringToSearch !
;! "
} 	
public&& 
static&& 
string&& 
RemoveFromEnd&& *
(&&* +
this&&+ /
string&&0 6
source&&7 =
,&&= >
string&&? E
value&&F K
)&&K L
{'' 	
if(( 
((( 
!(( 
string(( 
.(( 
IsNullOrEmpty(( %
(((% &
source((& ,
)((, -
&&((. 0
!((1 2
string((2 8
.((8 9
IsNullOrEmpty((9 F
(((F G
value((G L
)((L M
)((M N
{)) 
var** 

comparison** 
=**  
StringComparison**! 1
.**1 2
OrdinalIgnoreCase**2 C
;**C D
return++ 
source++ 
.++ 
EndsWith++ &
(++& '
value++' ,
,++, -

comparison++. 8
)++8 9
?++: ;
source++< B
.++B C
Remove++C I
(++I J
source++J P
.++P Q
LastIndexOf++Q \
(++\ ]
value++] b
,++b c

comparison++d n
)++n o
)++o p
:++q r
source++s y
;++y z
},, 
return-- 
source-- 
;-- 
}.. 	
public55 
static55 
decimal55 
?55 
	ToDecimal55 (
(55( )
this55) -
object55. 4
value555 :
)55: ;
{66 	
if77 
(77 
value77 
!=77 
null77 
&&77  
value88 
!=88 
DBNull88 
.88  
Value88  %
&&88& (
decimal99 
.99 
TryParse99  
(99  !
value99! &
.99& '
ToString99' /
(99/ 0
)990 1
,991 2
out993 6
decimal997 >
dec99? B
)99B C
)99C D
{:: 
return;; 
dec;; 
;;; 
}<< 
return== 
null== 
;== 
}>> 	
}?? 
}@@ ¬D
BC:\Projects\SqlServerAdoNet\SqlServerAdoNet\Helpers\ModelHelper.cs
	namespace 	
	StatKings
 
. 
SqlServerAdoNet #
{		 
internal 
static 
class 
ModelHelper %
{ 
public 
static 
	TableName 
GetTableName  ,
<, -
T- .
>. /
(/ 0
)0 1
{ 	
var 
type 
= 
typeof 
( 
T 
)  
;  !
var 
name 
= 
$str 
; 
var 
schema 
= 
$str 
; 
try 
{ 
name 
= 
type 
. 
GetAttributeValue -
(- .
(. /
TableAttribute/ =
a> ?
)? @
=>A C
aD E
.E F
NameF J
)J K
;K L
schema 
= 
type 
. 
GetAttributeValue /
(/ 0
(0 1
TableAttribute1 ?
a@ A
)A B
=>C E
aF G
.G H
SchemaH N
)N O
;O P
}   
catch!! 
{"" 
}$$ 
if'' 
('' 
string'' 
.'' 
IsNullOrWhiteSpace'' )
('') *
name''* .
)''. /
)''/ 0
{(( 
name)) 
=)) 
type)) 
.)) 
Name))  
.))  !
RemoveFromEnd))! .
()). /
$str))/ 4
)))4 5
;))5 6
}** 
return,, 
new,, 
	TableName,,  
{,,! "
Name,,# '
=,,( )
name,,* .
,,,. /
Schema,,0 6
=,,7 8
schema,,9 ?
},,@ A
;,,A B
}-- 	
public44 
static44 
IEnumerable44 !
<44! "
Column44" (
>44( )
GetTableColumns44* 9
<449 :
T44: ;
>44; <
(44< =
)44= >
{55 	
var66 
tableColumns66 
=66 
new66 "
List66# '
<66' (
Column66( .
>66. /
(66/ 0
)660 1
;661 2
var99 
props99 
=99 
ReflectionHelper99 (
.99( )
GetProperties99) 6
<996 7
T997 8
>998 9
(999 :
)99: ;
;99; <
foreach<< 
(<< 
var<< 
prop<< 
in<<  
props<<! &
)<<& '
{== 
var>> 
type>> 
=>> 
prop>> 
.>>  
PropertyType>>  ,
;>>, -
var@@ 
tableColumn@@ 
=@@  !
new@@" %
Column@@& ,
{@@- .
Id@@/ 1
=@@2 3
prop@@4 8
.@@8 9
Name@@9 =
,@@= >
Name@@? C
=@@D E
prop@@F J
.@@J K
Name@@K O
}@@P Q
;@@Q R
varCC 
keyAttrCC 
=CC 
propCC "
.CC" #
GetAttributeValueCC# 4
(CC4 5
(CC5 6
KeyAttributeCC6 B
aCCC D
)CCD E
=>CCF H
aCCI J
)CCJ K
;CCK L
ifDD 
(DD 
keyAttrDD 
!=DD 
nullDD #
)DD# $
{EE 
ifGG 
(GG 
typeGG 
.GG 
IsGenericTypeGG *
&&GG+ -
typeGG. 2
.GG2 3$
GetGenericTypeDefinitionGG3 K
(GGK L
)GGL M
==GGN P
typeofGGQ W
(GGW X
NullableGGX `
<GG` a
>GGa b
)GGb c
)GGc d
{HH 
throwII 
newII !$
ModelDefinitionExceptionII" :
(II: ;
$strII; b
)IIb c
;IIc d
}JJ 
tableColumnMM 
.MM  
IsPrimaryKeyMM  ,
=MM- .
trueMM/ 3
;MM3 4
}NN 
varQQ 
	dbGenAttrQQ 
=QQ 
propQQ  $
.QQ$ %
GetAttributeValueQQ% 6
(QQ6 7
(QQ7 8&
DatabaseGeneratedAttributeQQ8 R
aQQS T
)QQT U
=>QQV X
aQQY Z
)QQZ [
;QQ[ \
ifRR 
(RR 
	dbGenAttrRR 
!=RR  
nullRR! %
)RR% &
{SS 
varUU 
dbGenOptUU  
=UU! "
	dbGenAttrUU# ,
.UU, -#
DatabaseGeneratedOptionUU- D
;UUD E
ifXX 
(XX 
dbGenOptXX  
==XX! ##
DatabaseGeneratedOptionXX$ ;
.XX; <
IdentityXX< D
)XXD E
{YY 
tableColumnZZ #
.ZZ# $

IsIdentityZZ$ .
=ZZ/ 0
trueZZ1 5
;ZZ5 6
}[[ 
else\\ 
if\\ 
(\\ 
dbGenOpt\\ %
==\\& (#
DatabaseGeneratedOption\\) @
.\\@ A
Computed\\A I
)\\I J
{]] 
tableColumn^^ #
.^^# $

IsComputed^^$ .
=^^/ 0
true^^1 5
;^^5 6
}__ 
}`` 
varcc 
colAttrcc 
=cc 
propcc "
.cc" #
GetAttributeValuecc# 4
(cc4 5
(cc5 6
ColumnAttributecc6 E
accF G
)ccG H
=>ccI K
accL M
)ccM N
;ccN O
ifdd 
(dd 
colAttrdd 
!=dd 
nulldd #
)dd# $
{ee 
ifff 
(ff 
!ff 
stringff 
.ff  
IsNullOrWhiteSpaceff  2
(ff2 3
colAttrff3 :
.ff: ;
Nameff; ?
)ff? @
)ff@ A
{gg 
tableColumnhh #
.hh# $
Namehh$ (
=hh) *
colAttrhh+ 2
.hh2 3
Namehh3 7
;hh7 8
}ii 
ifll 
(ll 
!ll 
stringll 
.ll  
IsNullOrWhiteSpacell  2
(ll2 3
colAttrll3 :
.ll: ;
TypeNamell; C
)llC D
)llD E
{mm 
tableColumnnn #
.nn# $
	SqlDbTypenn$ -
=nn. /
	GetDbTypenn0 9
(nn9 :
colAttrnn: A
.nnA B
TypeNamennB J
)nnJ K
;nnK L
}oo 
}pp 
tableColumnsrr 
.rr 
Addrr  
(rr  !
tableColumnrr! ,
)rr, -
;rr- .
}ss 
ifvv 
(vv 
tableColumnsvv 
.vv 
Countvv "
(vv" #
xvv# $
=>vv% '
xvv( )
.vv) *
IsPrimaryKeyvv* 6
&&vv7 9
xvv: ;
.vv; <

IsIdentityvv< F
)vvF G
>vvH I
$numvvJ K
)vvK L
{ww 
throwxx 
newxx $
ModelDefinitionExceptionxx 2
(xx2 3
$strxx3 b
)xxb c
;xxc d
}yy 
if|| 
(|| 
tableColumns|| 
.|| 
GroupBy|| $
(||$ %
x||% &
=>||' )
x||* +
.||+ ,
Name||, 0
)||0 1
.||1 2
Any||2 5
(||5 6
g||6 7
=>||8 :
g||; <
.||< =
Count||= B
(||B C
)||C D
>||E F
$num||G H
)||H I
)||I J
{}} 
throw~~ 
new~~ $
ModelDefinitionException~~ 2
(~~2 3
$str~~3 q
)~~q r
;~~r s
} 
return
ÅÅ 
tableColumns
ÅÅ 
;
ÅÅ  
}
ÇÇ 	
private
ââ 
static
ââ 
	SqlDbType
ââ  
?
ââ  !
	GetDbType
ââ" +
(
ââ+ ,
string
ââ, 2
type
ââ3 7
)
ââ7 8
{
ää 	
	SqlDbType
ãã 
sqlType
ãã 
;
ãã 
if
åå 
(
åå 
Enum
åå 
.
åå 
TryParse
åå 
<
åå 
	SqlDbType
åå '
>
åå' (
(
åå( )
type
åå) -
,
åå- .
true
åå/ 3
,
åå3 4
out
åå5 8
sqlType
åå9 @
)
åå@ A
)
ååA B
{
çç 
return
éé 
sqlType
éé 
;
éé 
}
èè 
return
êê 
null
êê 
;
êê 
}
ëë 	
}
íí 
}ìì Ó»
CC:\Projects\SqlServerAdoNet\SqlServerAdoNet\Helpers\QueryBuilder.cs
	namespace 	
	StatKings
 
. 
SqlServerAdoNet #
{		 
internal 
class 
QueryBuilder 
<  
T  !
>! "
{ 
private 
readonly 
	QueryType "

_queryType# -
;- .
private 
readonly 
string 

_tableName  *
;* +
private 
readonly 
List 
< 
Column $
>$ %
_entityColumns& 4
=5 6
new7 :
List; ?
<? @
Column@ F
>F G
(G H
)H I
;I J
private 

Dictionary 
< 
string !
,! "
object# )
>) *!
_entityPropertyValues+ @
=A B
newC F

DictionaryG Q
<Q R
stringR X
,X Y
objectZ `
>` a
(a b
)b c
;c d
private 

Dictionary 
< 
string !
,! "
object# )
>) *
_primaryKeyValues+ <
== >
new? B

DictionaryC M
<M N
stringN T
,T U
objectV \
>\ ]
(] ^
)^ _
;_ `
private 
WhereProperties 
_whereProperties  0
;0 1
public 
QueryBuilder 
( 
	QueryType %
	queryType& /
)/ 0
{ 	

_queryType 
= 
	queryType "
;" #
_entityColumns   
=   
ModelHelper   (
.  ( )
GetTableColumns  ) 8
<  8 9
T  9 :
>  : ;
(  ; <
)  < =
.  = >
ToList  > D
(  D E
)  E F
;  F G
if"" 
("" 
_entityColumns"" 
."" 
Count"" $
==""% '
$num""( )
)"") *
{## 
throw$$ 
new$$ $
ModelDefinitionException$$ 2
($$2 3
$str$$3 f
)$$f g
;$$g h
}%% 
var(( 
	tableName(( 
=(( 
ModelHelper(( '
.((' (
GetTableName((( 4
<((4 5
T((5 6
>((6 7
(((7 8
)((8 9
;((9 :

_tableName)) 
=)) 
FormatTableName)) (
())( )
	tableName))) 2
.))2 3
Name))3 7
,))7 8
	tableName))9 B
.))B C
Schema))C I
)))I J
;))J K
}** 	
public00 
void00 
SetPrimaryKeyValues00 '
(00' (
params00( .
object00/ 5
[005 6
]006 7
primaryKeyValues008 H
)00H I
{11 	
if33 
(33 

_queryType33 
==33 
	QueryType33 '
.33' (
Insert33( .
||33/ 1

_queryType332 <
==33= ?
	QueryType33@ I
.33I J
Update33J P
)33P Q
{44 
throw55 
new55 %
InvalidOperationException55 3
(553 4
$str	554 ç
)
55ç é
;
55é è
}66 
if99 
(99 
primaryKeyValues99  
.99  !
Length99! '
==99( *
$num99+ ,
)99, -
{:: 
throw;; 
new;; 
ArgumentException;; +
(;;+ ,
$str;;, Y
);;Y Z
;;;Z [
}<< 
var?? 
primaryKeyColumns?? !
=??" #
_entityColumns??$ 2
.??2 3
Where??3 8
(??8 9
x??9 :
=>??; =
x??> ?
.??? @
IsPrimaryKey??@ L
)??L M
.??M N
ToList??N T
(??T U
)??U V
;??V W
ifBB 
(BB 
primaryKeyColumnsBB !
.BB! "
CountBB" '
==BB( *
$numBB+ ,
)BB, -
{CC 
throwDD 
newDD $
ModelDefinitionExceptionDD 2
(DD2 3
$strDD3 a
)DDa b
;DDb c
}EE 
ifFF 
(FF 
primaryKeyColumnsFF !
.FF! "
CountFF" '
!=FF( *
primaryKeyValuesFF+ ;
.FF; <
LengthFF< B
)FFB C
{GG 
throwHH 
newHH 
ArgumentExceptionHH +
(HH+ ,
$str	HH, è
)
HHè ê
;
HHê ë
}II 
_primaryKeyValuesLL 
=LL 
newLL  #

DictionaryLL$ .
<LL. /
stringLL/ 5
,LL5 6
objectLL7 =
>LL= >
(LL> ?
primaryKeyColumnsLL? P
.LLP Q
CountLLQ V
)LLV W
;LLW X
forMM 
(MM 
varMM 
iMM 
=MM 
$numMM 
;MM 
iMM 
<MM 
primaryKeyColumnsMM  1
.MM1 2
CountMM2 7
;MM7 8
iMM9 :
++MM: <
)MM< =
{NN 
_primaryKeyValuesOO !
.OO! "
AddOO" %
(OO% &
primaryKeyColumnsOO& 7
[OO7 8
iOO8 9
]OO9 :
.OO: ;
IdOO; =
,OO= >
primaryKeyValuesOO? O
[OOO P
iOOP Q
]OOQ R
)OOR S
;OOS T
}PP 
MakeWherePropertiesSS 
(SS  
)SS  !
;SS! "
}TT 	
publicZZ 
voidZZ 
SetEntityInstanceZZ %
(ZZ% &
TZZ& '
entityInstanceZZ( 6
)ZZ6 7
{[[ 	
if]] 
(]] 

_queryType]] 
==]] 
	QueryType]] '
.]]' (
Select]]( .
)]]. /
{^^ 
throw__ 
new__ %
InvalidOperationException__ 3
(__3 4
$str	__4 Ç
)
__Ç É
;
__É Ñ
}`` 
ifcc 
(cc 
entityInstancecc 
==cc !
nullcc" &
)cc& '
{dd 
throwee 
newee !
ArgumentNullExceptionee /
(ee/ 0
$stree0 Y
)eeY Z
;eeZ [
}ff !
_entityPropertyValuesii !
=ii" #
ReflectionHelperii$ 4
.ii4 5
GetPropertyValuesii5 F
(iiF G
entityInstanceiiG U
)iiU V
;iiV W
varll 
primaryKeyColumnsll !
=ll" #
_entityColumnsll$ 2
.ll2 3
Wherell3 8
(ll8 9
xll9 :
=>ll; =
xll> ?
.ll? @
IsPrimaryKeyll@ L
)llL M
.llM N
ToListllN T
(llT U
)llU V
;llV W
_primaryKeyValuesnn 
=nn 
newnn  #

Dictionarynn$ .
<nn. /
stringnn/ 5
,nn5 6
objectnn7 =
>nn= >
(nn> ?
primaryKeyColumnsnn? P
.nnP Q
CountnnQ V
)nnV W
;nnW X
foreachoo 
(oo 
varoo 
keyColoo 
inoo  "
primaryKeyColumnsoo# 4
)oo4 5
{pp 
_primaryKeyValuesqq !
.qq! "
Addqq" %
(qq% &
keyColqq& ,
.qq, -
Idqq- /
,qq/ 0!
_entityPropertyValuesqq1 F
[qqF G
keyColqqG M
.qqM N
IdqqN P
]qqP Q
)qqQ R
;qqR S
}rr 
MakeWherePropertiesuu 
(uu  
)uu  !
;uu! "
}vv 	
public|| 
CommandSettings|| 
MakeCommandSettings|| 2
(||2 3
)||3 4
{}} 	
switch~~ 
(~~ 

_queryType~~ 
)~~ 
{ 
case
ÄÄ 
	QueryType
ÄÄ 
.
ÄÄ 
Delete
ÄÄ %
:
ÄÄ% &
return
ÄÄ' - 
MakeDeleteSettings
ÄÄ. @
(
ÄÄ@ A
)
ÄÄA B
;
ÄÄB C
case
ÅÅ 
	QueryType
ÅÅ 
.
ÅÅ 
Insert
ÅÅ %
:
ÅÅ% &
return
ÅÅ' - 
MakeInsertSettings
ÅÅ. @
(
ÅÅ@ A
)
ÅÅA B
;
ÅÅB C
case
ÇÇ 
	QueryType
ÇÇ 
.
ÇÇ 
Select
ÇÇ %
:
ÇÇ% &
return
ÇÇ' - 
MakeSelectSettings
ÇÇ. @
(
ÇÇ@ A
)
ÇÇA B
;
ÇÇB C
case
ÉÉ 
	QueryType
ÉÉ 
.
ÉÉ 
Update
ÉÉ %
:
ÉÉ% &
return
ÉÉ' - 
MakeUpdateSettings
ÉÉ. @
(
ÉÉ@ A
)
ÉÉA B
;
ÉÉB C
}
ÑÑ 
throw
ÖÖ 
new
ÖÖ !
SqlBuilderException
ÖÖ )
(
ÖÖ) *
$str
ÖÖ* H
)
ÖÖH I
;
ÖÖI J
}
ÜÜ 	
private
åå 
CommandSettings
åå  
MakeSelectSettings
åå  2
(
åå2 3
)
åå3 4
{
çç 	
var
èè 
colNames
èè 
=
èè 
string
èè !
.
èè! "
Join
èè" &
(
èè& '
$str
èè' +
,
èè+ ,
_entityColumns
èè- ;
.
èè; <
Select
èè< B
(
èèB C
x
èèC D
=>
èèE G
AddBrackets
èèH S
(
èèS T
x
èèT U
.
èèU V
Name
èèV Z
)
èèZ [
)
èè[ \
)
èè\ ]
.
èè] ^
RemoveFromEnd
èè^ k
(
èèk l
$str
èèl p
)
èèp q
;
èèq r
if
íí 
(
íí 
_primaryKeyValues
íí !
.
íí! "
Count
íí" '
==
íí( *
$num
íí+ ,
)
íí, -
{
ìì 
return
îî 
new
îî 
CommandSettings
îî *
(
îî* +
string
îî+ 1
.
îî1 2
Format
îî2 8
(
îî8 9
$str
îî9 O
,
îîO P
colNames
îîQ Y
,
îîY Z

_tableName
îî[ e
)
îîe f
)
îîf g
;
îîg h
}
ïï 
return
óó 
new
óó 
CommandSettings
óó &
(
óó& '
string
óó' -
.
óó- .
Format
óó. 4
(
óó4 5
$str
óó5 U
,
óóU V
colNames
òò 
,
òò 

_tableName
òò $
,
òò$ %
_whereProperties
òò& 6
.
òò6 7
	Condition
òò7 @
)
òò@ A
,
òòA B
_whereProperties
òòC S
.
òòS T

Parameters
òòT ^
)
òò^ _
;
òò_ `
}
ôô 	
private
üü 
CommandSettings
üü  
MakeDeleteSettings
üü  2
(
üü2 3
)
üü3 4
{
†† 	
if
¢¢ 
(
¢¢ 
_primaryKeyValues
¢¢ !
.
¢¢! "
Count
¢¢" '
==
¢¢( *
$num
¢¢+ ,
)
¢¢, -
{
££ 
throw
§§ 
new
§§ !
SqlBuilderException
§§ -
(
§§- .
$str
§§. e
)
§§e f
;
§§f g
}
•• 
return
¶¶ 
new
¶¶ 
CommandSettings
¶¶ &
(
¶¶& '
string
¶¶' -
.
¶¶- .
Format
¶¶. 4
(
¶¶4 5
$str
¶¶5 Q
,
¶¶Q R

_tableName
ßß 
,
ßß 
_whereProperties
ßß ,
.
ßß, -
	Condition
ßß- 6
)
ßß6 7
,
ßß7 8
_whereProperties
ßß9 I
.
ßßI J

Parameters
ßßJ T
)
ßßT U
;
ßßU V
}
®® 	
private
ÆÆ 
CommandSettings
ÆÆ  
MakeUpdateSettings
ÆÆ  2
(
ÆÆ2 3
)
ÆÆ3 4
{
ØØ 	
if
±± 
(
±± 
_primaryKeyValues
±± !
.
±±! "
Count
±±" '
==
±±( *
$num
±±+ ,
)
±±, -
{
≤≤ 
throw
≥≥ 
new
≥≥ !
SqlBuilderException
≥≥ -
(
≥≥- .
$str
≥≥. e
)
≥≥e f
;
≥≥f g
}
¥¥ 
var
∑∑ 
props
∑∑ 
=
∑∑ "
MakeUpdateProperties
∑∑ ,
(
∑∑, -
)
∑∑- .
;
∑∑. /
var
ππ 
prms
ππ 
=
ππ 
new
ππ 
List
ππ 
<
ππ  
IDbDataParameter
ππ  0
>
ππ0 1
(
ππ1 2
props
ππ2 7
.
ππ7 8

Parameters
ππ8 B
)
ππB C
;
ππC D
prms
∫∫ 
.
∫∫ 
AddRange
∫∫ 
(
∫∫ 
_whereProperties
∫∫ *
.
∫∫* +

Parameters
∫∫+ 5
)
∫∫5 6
;
∫∫6 7
return
ºº 
new
ºº 
CommandSettings
ºº &
(
ºº& '
string
ºº' -
.
ºº- .
Format
ºº. 4
(
ºº4 5
$str
ºº5 T
,
ººT U

_tableName
ΩΩ 
,
ΩΩ 
props
ΩΩ !
.
ΩΩ! "
Columns
ΩΩ" )
,
ΩΩ) *
_whereProperties
ΩΩ+ ;
.
ΩΩ; <
	Condition
ΩΩ< E
)
ΩΩE F
,
ΩΩF G
prms
ΩΩH L
)
ΩΩL M
;
ΩΩM N
}
ææ 	
private
ƒƒ 
CommandSettings
ƒƒ  
MakeInsertSettings
ƒƒ  2
(
ƒƒ2 3
)
ƒƒ3 4
{
≈≈ 	
var
«« 
props
«« 
=
«« "
MakeInsertProperties
«« ,
(
««, -
)
««- .
;
««. /
var
ÀÀ 
identityColumn
ÀÀ 
=
ÀÀ  
_entityColumns
ÀÀ! /
.
ÀÀ/ 0
FirstOrDefault
ÀÀ0 >
(
ÀÀ> ?
x
ÀÀ? @
=>
ÀÀA C
x
ÀÀD E
.
ÀÀE F
IsPrimaryKey
ÀÀF R
&&
ÀÀS U
x
ÀÀV W
.
ÀÀW X

IsIdentity
ÀÀX b
)
ÀÀb c
;
ÀÀc d
if
ÕÕ 
(
ÕÕ 
identityColumn
ÕÕ 
!=
ÕÕ !
null
ÕÕ" &
)
ÕÕ& '
{
ŒŒ 
return
œœ 
new
œœ 
CommandSettings
œœ *
(
œœ* +
string
œœ+ 1
.
œœ1 2
Format
œœ2 8
(
œœ8 9
$str
œœ9 r
,
œœr s

_tableName
–– 
,
–– 
props
––  %
.
––% &
Columns
––& -
,
––- .
AddBrackets
––/ :
(
––: ;
identityColumn
––; I
.
––I J
Name
––J N
)
––N O
,
––O P
props
––Q V
.
––V W
Values
––W ]
)
––] ^
,
––^ _
props
––` e
.
––e f

Parameters
––f p
)
––p q
;
––q r
}
—— 
return
”” 
new
”” 
CommandSettings
”” &
(
””& '
string
””' -
.
””- .
Format
””. 4
(
””4 5
$str
””5 Z
,
””Z [

_tableName
‘‘ 
,
‘‘ 
props
‘‘ !
.
‘‘! "
Columns
‘‘" )
,
‘‘) *
props
‘‘+ 0
.
‘‘0 1
Values
‘‘1 7
)
‘‘7 8
,
‘‘8 9
props
‘‘: ?
.
‘‘? @

Parameters
‘‘@ J
)
‘‘J K
;
‘‘K L
}
’’ 	
private
€€ 
UpdateProperties
€€  "
MakeUpdateProperties
€€! 5
(
€€5 6
)
€€6 7
{
‹‹ 	
var
›› 
props
›› 
=
›› 
new
›› 
UpdateProperties
›› ,
(
››, -
)
››- .
;
››. /
foreach
ﬂﬂ 
(
ﬂﬂ 
var
ﬂﬂ 
col
ﬂﬂ 
in
ﬂﬂ 
_entityColumns
ﬂﬂ  .
)
ﬂﬂ. /
{
‡‡ 
if
‚‚ 
(
‚‚ 
col
‚‚ 
.
‚‚ 

IsComputed
‚‚ "
||
‚‚# %
col
‚‚& )
.
‚‚) *

IsIdentity
‚‚* 4
||
‚‚5 7
col
‚‚8 ;
.
‚‚; <
IsPrimaryKey
‚‚< H
)
‚‚H I
{
„„ 
continue
‰‰ 
;
‰‰ 
}
ÂÂ 
var
ÁÁ 
prmName
ÁÁ 
=
ÁÁ 
QueryHelper
ÁÁ )
.
ÁÁ) *
MakeParameterName
ÁÁ* ;
(
ÁÁ; <
col
ÁÁ< ?
.
ÁÁ? @
Name
ÁÁ@ D
)
ÁÁD E
;
ÁÁE F
props
ËË 
.
ËË 
Columns
ËË 
+=
ËË  
string
ËË! '
.
ËË' (
Format
ËË( .
(
ËË. /
$str
ËË/ <
,
ËË< =
AddBrackets
ËË> I
(
ËËI J
col
ËËJ M
.
ËËM N
Name
ËËN R
)
ËËR S
,
ËËS T
prmName
ËËU \
)
ËË\ ]
;
ËË] ^
props
ÈÈ 
.
ÈÈ 

Parameters
ÈÈ  
.
ÈÈ  !
Add
ÈÈ! $
(
ÈÈ$ %
MakeSqlParameter
ÈÈ% 5
(
ÈÈ5 6
prmName
ÈÈ6 =
,
ÈÈ= >#
_entityPropertyValues
ÈÈ? T
[
ÈÈT U
col
ÈÈU X
.
ÈÈX Y
Id
ÈÈY [
]
ÈÈ[ \
.
ÈÈ\ ]
ToDBNull
ÈÈ] e
(
ÈÈe f
)
ÈÈf g
,
ÈÈg h
col
ÈÈi l
.
ÈÈl m
	SqlDbType
ÈÈm v
)
ÈÈv w
)
ÈÈw x
;
ÈÈx y
}
ÍÍ 
props
ÎÎ 
.
ÎÎ 
Columns
ÎÎ 
=
ÎÎ 
props
ÎÎ !
.
ÎÎ! "
Columns
ÎÎ" )
.
ÎÎ) *
RemoveFromEnd
ÎÎ* 7
(
ÎÎ7 8
$str
ÎÎ8 <
)
ÎÎ< =
;
ÎÎ= >
if
ÓÓ 
(
ÓÓ 
string
ÓÓ 
.
ÓÓ 
IsNullOrEmpty
ÓÓ $
(
ÓÓ$ %
props
ÓÓ% *
.
ÓÓ* +
Columns
ÓÓ+ 2
)
ÓÓ2 3
)
ÓÓ3 4
{
ÔÔ 
throw
 
new
 !
SqlBuilderException
 -
(
- .
$str
. b
)
b c
;
c d
}
ÒÒ 
return
ÚÚ 
props
ÚÚ 
;
ÚÚ 
}
ÛÛ 	
private
˘˘ 
InsertProperties
˘˘  "
MakeInsertProperties
˘˘! 5
(
˘˘5 6
)
˘˘6 7
{
˙˙ 	
var
˚˚ 
props
˚˚ 
=
˚˚ 
new
˚˚ 
InsertProperties
˚˚ ,
(
˚˚, -
)
˚˚- .
;
˚˚. /
foreach
˝˝ 
(
˝˝ 
var
˝˝ 
col
˝˝ 
in
˝˝ 
_entityColumns
˝˝  .
)
˝˝. /
{
˛˛ 
if
ÄÄ 
(
ÄÄ 
col
ÄÄ 
.
ÄÄ 

IsComputed
ÄÄ "
||
ÄÄ# %
col
ÄÄ& )
.
ÄÄ) *

IsIdentity
ÄÄ* 4
)
ÄÄ4 5
{
ÅÅ 
continue
ÇÇ 
;
ÇÇ 
}
ÉÉ 
var
ÖÖ 
prmName
ÖÖ 
=
ÖÖ 
QueryHelper
ÖÖ )
.
ÖÖ) *
MakeParameterName
ÖÖ* ;
(
ÖÖ; <
col
ÖÖ< ?
.
ÖÖ? @
Name
ÖÖ@ D
)
ÖÖD E
;
ÖÖE F
props
ÜÜ 
.
ÜÜ 
Columns
ÜÜ 
+=
ÜÜ  
AddCommaDelimiter
ÜÜ! 2
(
ÜÜ2 3
AddBrackets
ÜÜ3 >
(
ÜÜ> ?
col
ÜÜ? B
.
ÜÜB C
Name
ÜÜC G
)
ÜÜG H
)
ÜÜH I
;
ÜÜI J
props
áá 
.
áá 
Values
áá 
+=
áá 
AddCommaDelimiter
áá  1
(
áá1 2
prmName
áá2 9
)
áá9 :
;
áá: ;
props
àà 
.
àà 

Parameters
àà  
.
àà  !
Add
àà! $
(
àà$ %
MakeSqlParameter
àà% 5
(
àà5 6
prmName
àà6 =
,
àà= >#
_entityPropertyValues
àà? T
[
ààT U
col
ààU X
.
ààX Y
Id
ààY [
]
àà[ \
.
àà\ ]
ToDBNull
àà] e
(
ààe f
)
ààf g
,
ààg h
col
àài l
.
ààl m
	SqlDbType
ààm v
)
ààv w
)
ààw x
;
ààx y
}
ââ 
props
ää 
.
ää 
Columns
ää 
=
ää 
props
ää !
.
ää! "
Columns
ää" )
.
ää) *
RemoveFromEnd
ää* 7
(
ää7 8
$str
ää8 <
)
ää< =
;
ää= >
props
ãã 
.
ãã 
Values
ãã 
=
ãã 
props
ãã  
.
ãã  !
Values
ãã! '
.
ãã' (
RemoveFromEnd
ãã( 5
(
ãã5 6
$str
ãã6 :
)
ãã: ;
;
ãã; <
if
éé 
(
éé 
string
éé 
.
éé 
IsNullOrEmpty
éé $
(
éé$ %
props
éé% *
.
éé* +
Columns
éé+ 2
)
éé2 3
)
éé3 4
{
èè 
throw
êê 
new
êê !
SqlBuilderException
êê -
(
êê- .
$str
êê. b
)
êêb c
;
êêc d
}
ëë 
return
íí 
props
íí 
;
íí 
}
ìì 	
private
òò 
void
òò !
MakeWhereProperties
òò (
(
òò( )
)
òò) *
{
ôô 	
_whereProperties
öö 
=
öö 
new
öö "
WhereProperties
öö# 2
(
öö2 3
)
öö3 4
;
öö4 5
foreach
õõ 
(
õõ 
var
õõ 

primaryKey
õõ #
in
õõ$ &
_primaryKeyValues
õõ' 8
)
õõ8 9
{
úú 
var
ùù 
col
ùù 
=
ùù 
_entityColumns
ùù (
.
ùù( )
First
ùù) .
(
ùù. /
x
ùù/ 0
=>
ùù1 3
x
ùù4 5
.
ùù5 6
Id
ùù6 8
==
ùù9 ;

primaryKey
ùù< F
.
ùùF G
Key
ùùG J
)
ùùJ K
;
ùùK L
var
üü 
prmName
üü 
=
üü 
QueryHelper
üü )
.
üü) *
MakeParameterName
üü* ;
(
üü; <
col
üü< ?
.
üü? @
Name
üü@ D
)
üüD E
;
üüE F
_whereProperties
††  
.
††  !
	Condition
††! *
+=
††+ -
string
††. 4
.
††4 5
Format
††5 ;
(
††; <
$str
††< L
,
††L M
AddBrackets
††N Y
(
††Y Z
col
††Z ]
.
††] ^
Name
††^ b
)
††b c
,
††c d
prmName
††e l
)
††l m
;
††m n
_whereProperties
¢¢  
.
¢¢  !

Parameters
¢¢! +
.
¢¢+ ,
Add
¢¢, /
(
¢¢/ 0
MakeSqlParameter
¢¢0 @
(
¢¢@ A
prmName
¢¢A H
,
¢¢H I

primaryKey
¢¢J T
.
¢¢T U
Value
¢¢U Z
.
¢¢Z [
ToDBNull
¢¢[ c
(
¢¢c d
)
¢¢d e
,
¢¢e f
col
¢¢g j
.
¢¢j k
	SqlDbType
¢¢k t
)
¢¢t u
)
¢¢u v
;
¢¢v w
}
££ 
_whereProperties
§§ 
.
§§ 
	Condition
§§ &
=
§§' (
_whereProperties
§§) 9
.
§§9 :
	Condition
§§: C
.
§§C D
RemoveFromEnd
§§D Q
(
§§Q R
$str
§§R Y
)
§§Y Z
;
§§Z [
}
•• 	
private
¨¨ 
string
¨¨ 
AddBrackets
¨¨ "
(
¨¨" #
string
¨¨# )
val
¨¨* -
)
¨¨- .
{
≠≠ 	
return
ÆÆ 
$str
ÆÆ 
+
ÆÆ 
val
ÆÆ 
+
ÆÆ 
$str
ÆÆ "
;
ÆÆ" #
}
ØØ 	
private
∂∂ 
string
∂∂ 
AddCommaDelimiter
∂∂ (
(
∂∂( )
string
∂∂) /
val
∂∂0 3
)
∂∂3 4
{
∑∑ 	
return
∏∏ 
val
∏∏ 
+=
∏∏ 
$str
∏∏ 
;
∏∏ 
}
ππ 	
private
¡¡ 
string
¡¡ 
FormatTableName
¡¡ &
(
¡¡& '
string
¡¡' -
name
¡¡. 2
,
¡¡2 3
string
¡¡4 :
schema
¡¡; A
)
¡¡A B
{
¬¬ 	
if
√√ 
(
√√ 
string
√√ 
.
√√  
IsNullOrWhiteSpace
√√ )
(
√√) *
schema
√√* 0
)
√√0 1
)
√√1 2
{
ƒƒ 
return
≈≈ 
AddBrackets
≈≈ "
(
≈≈" #
name
≈≈# '
)
≈≈' (
;
≈≈( )
}
∆∆ 
else
«« 
{
»» 
return
…… 
AddBrackets
…… "
(
……" #
schema
……# )
)
……) *
+
……+ ,
$str
……- 0
+
……1 2
AddBrackets
……3 >
(
……> ?
name
……? C
)
……C D
;
……D E
}
   
}
ÀÀ 	
private
‘‘ 
SqlParameter
‘‘ 
MakeSqlParameter
‘‘ -
(
‘‘- .
string
‘‘. 4
name
‘‘5 9
,
‘‘9 :
object
‘‘; A
value
‘‘B G
,
‘‘G H
	SqlDbType
‘‘I R
?
‘‘R S
	sqlDbType
‘‘T ]
)
‘‘] ^
{
’’ 	
var
÷÷ 
param
÷÷ 
=
÷÷ 
new
÷÷ 
SqlParameter
÷÷ (
(
÷÷( )
name
÷÷) -
,
÷÷- .
value
÷÷/ 4
)
÷÷4 5
;
÷÷5 6
if
◊◊ 
(
◊◊ 
	sqlDbType
◊◊ 
.
◊◊ 
HasValue
◊◊ "
)
◊◊" #
param
◊◊$ )
.
◊◊) *
	SqlDbType
◊◊* 3
=
◊◊4 5
	sqlDbType
◊◊6 ?
.
◊◊? @
Value
◊◊@ E
;
◊◊E F
return
ÿÿ 
param
ÿÿ 
;
ÿÿ 
}
ŸŸ 	
}
⁄⁄ 
}€€ û?
BC:\Projects\SqlServerAdoNet\SqlServerAdoNet\Helpers\QueryHelper.cs
	namespace

 	
	StatKings


 
.

 
SqlServerAdoNet

 #
{ 
public 

static 
class 
QueryHelper #
{ 
public 
static 
IDbDataParameter &$
MakeTableValuedParameter' ?
<? @
T@ A
>A B
(B C
stringC I
	paramNameJ S
,S T
IEnumerableU `
<` a
Ta b
>b c
datad h
,h i
paramsj p
stringq w
[w x
]x y
columnNames	z Ö
)
Ö Ü
{ 	
var 
prm 
= 
new 
SqlParameter &
(& '
	paramName' 0
,0 1
	SqlDbType2 ;
.; <

Structured< F
)F G
;G H
using 
( 
var 
table 
= 
new "
	DataTable# ,
(, -
)- .
). /
{ 
if   
(   
typeof   
(   
T   
)   
.   
IsValueType   )
||  * ,
typeof  - 3
(  3 4
T  4 5
)  5 6
.  6 7
Equals  7 =
(  = >
typeof  > D
(  D E
string  E K
)  K L
)  L M
)  M N
{!! 
var"" 
colName"" 
=""  !
(""" #
columnNames""# .
."". /
Length""/ 5
>""6 7
$num""8 9
)""9 :
?""; <
columnNames""= H
[""H I
$num""I J
]""J K
:""L M
$str""N U
;""U V
var## 
dc## 
=## 
new##  

DataColumn##! +
(##+ ,
colName##, 3
)##3 4
;##4 5
dc$$ 
.$$ 
DataType$$ 
=$$  !
typeof$$" (
($$( )
T$$) *
)$$* +
;$$+ ,
table%% 
.%% 
Columns%% !
.%%! "
Add%%" %
(%%% &
dc%%& (
)%%( )
;%%) *
foreach'' 
('' 
var''  
item''! %
in''& (
data'') -
)''- .
{(( 
var)) 
dr)) 
=))  
table))! &
.))& '
NewRow))' -
())- .
))). /
;))/ 0
dr** 
[** 
$num** 
]** 
=** 
item**  $
;**$ %
table++ 
.++ 
Rows++ "
.++" #
Add++# &
(++& '
dr++' )
)++) *
;++* +
},, 
}-- 
else.. 
{// 
if33 
(33 
columnNames33 #
.33# $
Length33$ *
==33+ -
$num33. /
)33/ 0
{44 
columnNames55 #
=55$ %
ReflectionHelper55& 6
.556 7
GetPropertyNames557 G
<55G H
T55H I
>55I J
(55J K
)55K L
.55L M
ToArray55M T
(55T U
)55U V
;55V W
}66 
using88 
(88 
var88 
reader88 %
=88& '
ObjectReader88( 4
.884 5
Create885 ;
(88; <
data88< @
,88@ A
columnNames88B M
)88M N
)88N O
{99 
table:: 
.:: 
Load:: "
(::" #
reader::# )
)::) *
;::* +
};; 
}<< 
prm>> 
.>> 
Value>> 
=>> 
table>> !
;>>! "
}?? 
returnAA 
prmAA 
;AA 
}BB 	
publicKK 
staticKK 
InClausePropertiesKK (%
ParameterizeInClauseQueryKK) B
<KKB C
TKKC D
>KKD E
(KKE F
stringKKF L
queryKKM R
,KKR S
IEnumerableKKT _
<KK_ `
TKK` a
>KKa b
inClauseDataKKc o
)KKo p
{LL 	
ifMM 
(MM 
stringMM 
.MM 
IsNullOrWhiteSpaceMM )
(MM) *
queryMM* /
)MM/ 0
)MM0 1
{NN 
throwOO 
newOO 
ArgumentExceptionOO +
(OO+ ,
$strOO, B
)OOB C
;OOC D
}PP 
ifQQ 
(QQ 
queryQQ 
.QQ 
IndexOfQQ 
(QQ 
$strQQ (
,QQ( )
StringComparisonQQ* :
.QQ: ;
OrdinalIgnoreCaseQQ; L
)QQL M
==QQN P
-QQQ R
$numQQR S
)QQS T
{RR 
throwSS 
newSS 
ArgumentExceptionSS +
(SS+ ,
$strSS, V
)SSV W
;SSW X
}TT 
ifUU 
(UU 
inClauseDataUU 
==UU 
nullUU  $
||UU% '
!UU( )
inClauseDataUU) 5
.UU5 6
AnyUU6 9
(UU9 :
)UU: ;
)UU; <
{VV 
throwWW 
newWW 
ArgumentExceptionWW +
(WW+ ,
$strWW, Q
)WWQ R
;WWR S
}XX 
var[[ 

paramNames[[ 
=[[ 
inClauseData[[ )
.[[) *
Select[[* 0
([[0 1
([[1 2
s[[2 3
,[[3 4
i[[5 6
)[[6 7
=>[[8 :
MakeParameterName[[; L
([[L M
$str[[M W
+[[X Y
i[[Z [
.[[[ \
ToString[[\ d
([[d e
)[[e f
)[[f g
)[[g h
.[[h i
ToArray[[i p
([[p q
)[[q r
;[[r s
var^^ 
outQuery^^ 
=^^ 
string^^ !
.^^! "
Format^^" (
(^^( )
query^^) .
,^^. /
String^^0 6
.^^6 7
Join^^7 ;
(^^; <
$str^^< ?
,^^? @

paramNames^^A K
)^^K L
)^^L M
;^^M N
varaa 
prmsaa 
=aa 
newaa 
Listaa 
<aa  
IDbDataParameteraa  0
>aa0 1
(aa1 2
)aa2 3
;aa3 4
forbb 
(bb 
intbb 
ibb 
=bb 
$numbb 
;bb 
ibb 
<bb 

paramNamesbb  *
.bb* +
Lengthbb+ 1
;bb1 2
ibb3 4
++bb4 6
)bb6 7
{cc 
prmsdd 
.dd 
Adddd 
(dd 
newdd 
SqlParameterdd )
(dd) *

paramNamesdd* 4
[dd4 5
idd5 6
]dd6 7
,dd7 8
inClauseDatadd9 E
.ddE F
	ElementAtddF O
(ddO P
iddP Q
)ddQ R
.ddR S
ToDBNullddS [
(dd[ \
)dd\ ]
)dd] ^
)dd^ _
;dd_ `
}ee 
returngg 
newgg 
InClausePropertiesgg )
(gg) *
)gg* +
{gg, -
Querygg. 3
=gg4 5
outQuerygg6 >
,gg> ?

Parametersgg@ J
=ggK L
prmsggM Q
}ggR S
;ggS T
}hh 	
publicoo 
staticoo 
objectoo 
ToDBNulloo %
(oo% &
thisoo& *
objectoo+ 1
valueoo2 7
)oo7 8
{pp 	
returnqq 
valueqq 
??qq 
DBNullqq "
.qq" #
Valueqq# (
;qq( )
}rr 	
internalyy 
staticyy 
stringyy 
MakeParameterNameyy 0
(yy0 1
stringyy1 7
	paramNameyy8 A
)yyA B
{zz 	
return{{ 
$str{{ 
+{{ 
	paramName{{ "
;{{" #
}|| 	
}}} 
}~~ ∫A
GC:\Projects\SqlServerAdoNet\SqlServerAdoNet\Helpers\ReflectionHelper.cs
	namespace 	
	StatKings
 
. 
SqlServerAdoNet #
{ 
internal 
static 
class 
ReflectionHelper *
{ 
public 
static 
TValue 
GetAttributeValue .
<. /

TAttribute/ 9
,9 :
TValue; A
>A B
(B C
thisC G
TypeH L
typeM Q
,Q R
FuncS W
<W X

TAttributeX b
,b c
TValued j
>j k
valueSelectorl y
)y z
where	{ Ä

TAttribute
Å ã
:
å ç
	Attribute
é ó
{ 	
var 
attr 
= 
type 
. 
GetCustomAttributes /
(/ 0
typeof0 6
(6 7

TAttribute7 A
)A B
,B C
trueD H
)H I
.I J
FirstOrDefaultJ X
(X Y
)Y Z
as[ ]

TAttribute^ h
;h i
return 
GetAttributeValue $
($ %
attr% )
,) *
valueSelector+ 8
)8 9
;9 :
} 	
public$$ 
static$$ 
TValue$$ 
GetAttributeValue$$ .
<$$. /

TAttribute$$/ 9
,$$9 :
TValue$$; A
>$$A B
($$B C
this$$C G
PropertyInfo$$H T
prop$$U Y
,$$Y Z
Func$$[ _
<$$_ `

TAttribute$$` j
,$$j k
TValue$$l r
>$$r s
valueSelector	$$t Å
)
$$Å Ç
where
$$É à

TAttribute
$$â ì
:
$$î ï
	Attribute
$$ñ ü
{%% 	
var&& 
attr&& 
=&& 
prop&& 
.&& 
GetCustomAttributes&& /
(&&/ 0
typeof&&0 6
(&&6 7

TAttribute&&7 A
)&&A B
,&&B C
true&&D H
)&&H I
.&&I J
FirstOrDefault&&J X
(&&X Y
)&&Y Z
as&&[ ]

TAttribute&&^ h
;&&h i
return'' 
GetAttributeValue'' $
(''$ %
attr''% )
,'') *
valueSelector''+ 8
)''8 9
;''9 :
}(( 	
private22 
static22 
TValue22 
GetAttributeValue22 /
<22/ 0

TAttribute220 :
,22: ;
TValue22< B
>22B C
(22C D

TAttribute22D N
attr22O S
,22S T
Func22U Y
<22Y Z

TAttribute22Z d
,22d e
TValue22f l
>22l m
valueSelector22n {
)22{ |
where	22} Ç

TAttribute
22É ç
:
22é è
	Attribute
22ê ô
{33 	
if44 
(44 
attr44 
!=44 
null44 
)44 
{55 
return66 
valueSelector66 $
(66$ %
attr66% )
)66) *
;66* +
}77 
return88 
default88 
(88 
TValue88 !
)88! "
;88" #
}99 	
publicAA 
staticAA 
PropertyInfoAA "
GetPropertyAA# .
<AA. /
TAA/ 0
>AA0 1
(AA1 2
stringAA2 8
propNameAA9 A
)AAA B
{BB 	
returnCC 
typeofCC 
(CC 
TCC 
)CC 
.CC 
GetPropertyCC (
(CC( )
propNameCC) 1
,CC1 2
BindingFlagsCC3 ?
.CC? @

IgnoreCaseCC@ J
|CCK L
BindingFlagsCCM Y
.CCY Z
PublicCCZ `
|CCa b
BindingFlagsCCc o
.CCo p
InstanceCCp x
)CCx y
;CCy z
}DD 	
publicKK 
staticKK 
PropertyInfoKK "
[KK" #
]KK# $
GetPropertiesKK% 2
<KK2 3
TKK3 4
>KK4 5
(KK5 6
)KK6 7
{LL 	
returnMM 
GetPropertiesMM  
(MM  !
typeofMM! '
(MM' (
TMM( )
)MM) *
)MM* +
;MM+ ,
}NN 	
privateUU 
staticUU 
PropertyInfoUU #
[UU# $
]UU$ %
GetPropertiesUU& 3
(UU3 4
TypeUU4 8
typeUU9 =
)UU= >
{VV 	
returnWW 
typeWW 
.WW 
GetPropertiesWW %
(WW% &
BindingFlagsWW& 2
.WW2 3

IgnoreCaseWW3 =
|WW> ?
BindingFlagsWW@ L
.WWL M
PublicWWM S
|WWT U
BindingFlagsWWV b
.WWb c
InstanceWWc k
)WWk l
;WWl m
}XX 	
public`` 
static`` 

Dictionary``  
<``  !
string``! '
,``' (
object``) /
>``/ 0
GetPropertyValues``1 B
<``B C
T``C D
>``D E
(``E F
T``F G
entity``H N
)``N O
{aa 	
varbb 

propValuesbb 
=bb 
newbb  

Dictionarybb! +
<bb+ ,
stringbb, 2
,bb2 3
objectbb4 :
>bb: ;
(bb; <
)bb< =
;bb= >
vardd 
propsdd 
=dd 
GetPropertiesdd %
(dd% &
entitydd& ,
.dd, -
GetTypedd- 4
(dd4 5
)dd5 6
)dd6 7
;dd7 8
foreachee 
(ee 
varee 
propee 
inee  
propsee! &
)ee& '
{ff 

propValuesgg 
.gg 
Addgg 
(gg 
propgg #
.gg# $
Namegg$ (
,gg( )
propgg* .
.gg. /
GetValuegg/ 7
(gg7 8
entitygg8 >
,gg> ?
nullgg@ D
)ggD E
)ggE F
;ggF G
}hh 
returnjj 

propValuesjj 
;jj 
}kk 	
publicrr 
staticrr 
IEnumerablerr !
<rr! "
stringrr" (
>rr( )
GetPropertyNamesrr* :
<rr: ;
Trr; <
>rr< =
(rr= >
)rr> ?
{ss 	
vartt 
propstt 
=tt 
GetPropertiestt %
<tt% &
Ttt& '
>tt' (
(tt( )
)tt) *
;tt* +
returnuu 
propsuu 
.uu 
Selectuu 
(uu  
xuu  !
=>uu" $
xuu% &
.uu& '
Nameuu' +
)uu+ ,
;uu, -
}vv 	
public}} 
static}} 

Dictionary}}  
<}}  !
string}}! '
,}}' (
string}}) /
>}}/ 0"
GetPropertyColumnNames}}1 G
<}}G H
T}}H I
>}}I J
(}}J K
)}}K L
{~~ 	
var 
colNames 
= 
new 

Dictionary )
<) *
string* 0
,0 1
string2 8
>8 9
(9 :
): ;
;; <
var
ÅÅ 
props
ÅÅ 
=
ÅÅ 
GetProperties
ÅÅ %
<
ÅÅ% &
T
ÅÅ& '
>
ÅÅ' (
(
ÅÅ( )
)
ÅÅ) *
;
ÅÅ* +
foreach
ÇÇ 
(
ÇÇ 
var
ÇÇ 
prop
ÇÇ 
in
ÇÇ  
props
ÇÇ! &
)
ÇÇ& '
{
ÉÉ 
var
ÑÑ 
colName
ÑÑ 
=
ÑÑ 
prop
ÑÑ "
.
ÑÑ" #
GetAttributeValue
ÑÑ# 4
(
ÑÑ4 5
(
ÑÑ5 6
ColumnAttribute
ÑÑ6 E
a
ÑÑF G
)
ÑÑG H
=>
ÑÑI K
a
ÑÑL M
.
ÑÑM N
Name
ÑÑN R
)
ÑÑR S
??
ÑÑT V
prop
ÑÑW [
.
ÑÑ[ \
Name
ÑÑ\ `
;
ÑÑ` a
colNames
ÖÖ 
.
ÖÖ 
Add
ÖÖ 
(
ÖÖ 
prop
ÖÖ !
.
ÖÖ! "
Name
ÖÖ" &
,
ÖÖ& '
colName
ÖÖ( /
)
ÖÖ/ 0
;
ÖÖ0 1
}
ÜÜ 
return
àà 
colNames
àà 
;
àà 
}
ââ 	
}
ää 
}ãã “
DC:\Projects\SqlServerAdoNet\SqlServerAdoNet\Interfaces\ISqlRunner.cs
	namespace 	
	StatKings
 
. 
SqlServerAdoNet #
{ 
public 

	interface 

ISqlRunner 
{ 
T 	
Get
 
< 
T 
> 
( 
params 
object 
[ 
]  
	keyValues! *
)* +
;+ ,
IEnumerable

 
<

 
T

 
>

 
GetAll

 
<

 
T

 
>

  
(

  !
)

! "
;

" #
void 
Delete 
< 
T 
> 
( 
params 
object $
[$ %
]% &
	keyValues' 0
)0 1
;1 2
int 
InsertForId 
< 
T 
> 
( 
T 
entity #
)# $
;$ %
void 
Insert 
< 
T 
> 
( 
T 
entity 
)  
;  !
void 
Update 
< 
T 
> 
( 
T 
entity 
)  
;  !
void 
ExecuteNonQuery 
( 
CommandSettings ,
commandSettings- <
)< =
;= >
object 
ExecuteScalar 
( 
CommandSettings ,
commandSettings- <
)< =
;= >
T 	
ExecuteReaderFirst
 
< 
T 
> 
(  
CommandSettings  /
commandSettings0 ?
)? @
;@ A
IEnumerable 
< 
T 
> 
ExecuteReader $
<$ %
T% &
>& '
(' (
CommandSettings( 7
commandSettings8 G
)G H
;H I
} 
} ®
EC:\Projects\SqlServerAdoNet\SqlServerAdoNet\Interfaces\IUnitOfWork.cs
	namespace 	
	StatKings
 
. 
SqlServerAdoNet #
{ 
public 

	interface 
IUnitOfWork  
:! "
IDisposable# .
{ 

IDbCommand 
CreateCommand  
(  !
)! "
;" #
void		 
BeginTransaction		 
(		 
)		 
;		  
void

 
Commit

 
(

 
)

 
;

 
void 
Rollback 
( 
) 
; 
} 
} æ	
<C:\Projects\SqlServerAdoNet\SqlServerAdoNet\Models\Column.cs
	namespace 	
	StatKings
 
. 
SqlServerAdoNet #
{ 
internal 
class 
Column 
{		 
public 
string 
Id 
{ 
get 
; 
set  #
;# $
}% &
public 
string 
Name 
{ 
get  
;  !
set" %
;% &
}' (
public 
bool 
IsPrimaryKey  
{! "
get# &
;& '
set( +
;+ ,
}- .
public 
bool 

IsIdentity 
{  
get! $
;$ %
set& )
;) *
}+ ,
public!! 
bool!! 

IsComputed!! 
{!!  
get!!! $
;!!$ %
set!!& )
;!!) *
}!!+ ,
public&& 
	SqlDbType&& 
?&& 
	SqlDbType&& #
{&&$ %
get&&& )
;&&) *
set&&+ .
;&&. /
}&&0 1
}'' 
}(( ≤%
EC:\Projects\SqlServerAdoNet\SqlServerAdoNet\Models\CommandSettings.cs
	namespace 	
	StatKings
 
. 
SqlServerAdoNet #
{ 
public

 

class

 
CommandSettings

  
{ 
private 
CommandType 
_commandType (
;( )
private 
string 
_commandText #
;# $
private 
IEnumerable 
< 
IDbDataParameter ,
>, -
_parameters. 9
;9 :
public 
CommandSettings 
( 
string %
commandText& 1
)1 2
{ 	
SetProperties 
( 
CommandType %
.% &
Text& *
,* +
commandText, 7
,7 8
new9 <
List= A
<A B
IDbDataParameterB R
>R S
(S T
)T U
)U V
;V W
} 	
public 
CommandSettings 
( 
CommandType *
commandType+ 6
,6 7
string8 >
commandText? J
)J K
{ 	
SetProperties   
(   
commandType   %
,  % &
commandText  ' 2
,  2 3
new  4 7
List  8 <
<  < =
IDbDataParameter  = M
>  M N
(  N O
)  O P
)  P Q
;  Q R
}!! 	
public(( 
CommandSettings(( 
((( 
string(( %
commandText((& 1
,((1 2
IEnumerable((3 >
<((> ?
IDbDataParameter((? O
>((O P

parameters((Q [
)(([ \
{)) 	
SetProperties** 
(** 
CommandType** %
.**% &
Text**& *
,*** +
commandText**, 7
,**7 8

parameters**9 C
)**C D
;**D E
}++ 	
public33 
CommandSettings33 
(33 
CommandType33 *
commandType33+ 6
,336 7
string338 >
commandText33? J
,33J K
IEnumerable33L W
<33W X
IDbDataParameter33X h
>33h i

parameters33j t
)33t u
{44 	
SetProperties55 
(55 
commandType55 %
,55% &
commandText55' 2
,552 3

parameters554 >
)55> ?
;55? @
}66 	
public;; 
CommandType;; 
CommandType;; &
{;;' (
get;;) ,
{;;- .
return;;/ 5
_commandType;;6 B
;;;B C
};;D E
};;F G
public@@ 
string@@ 
CommandText@@ !
{@@" #
get@@$ '
{@@( )
return@@* 0
_commandText@@1 =
;@@= >
}@@? @
}@@A B
publicEE 
IEnumerableEE 
<EE 
IDbDataParameterEE +
>EE+ ,

ParametersEE- 7
{EE8 9
getEE: =
{EE> ?
returnEE@ F
_parametersEEG R
;EER S
}EET U
}EEV W
privateMM 
voidMM 
SetPropertiesMM "
(MM" #
CommandTypeMM# .
commandTypeMM/ :
,MM: ;
stringMM< B
commandTextMMC N
,MMN O
IEnumerableMMP [
<MM[ \
IDbDataParameterMM\ l
>MMl m

parametersMMn x
)MMx y
{NN 	
ifOO 
(OO 
commandTypeOO 
==OO 
CommandTypeOO *
.OO* +
TableDirectOO+ 6
)OO6 7
{PP 
throwQQ 
newQQ 
ArgumentExceptionQQ +
(QQ+ ,
$"QQ, .
{QQ. /
nameofQQ/ 5
(QQ5 6
commandTypeQQ6 A
)QQA B
}QQB C'
 TableDirect not supported.QQC ^
"QQ^ _
)QQ_ `
;QQ` a
}RR 
ifTT 
(TT 
stringTT 
.TT 
IsNullOrWhiteSpaceTT )
(TT) *
commandTextTT* 5
)TT5 6
)TT6 7
{UU 
throwVV 
newVV 
ArgumentExceptionVV +
(VV+ ,
$"VV, .
{VV. /
nameofVV/ 5
(VV5 6
commandTextVV6 A
)VVA B
}VVB C
 is required.VVC P
"VVP Q
)VVQ R
;VVR S
}WW 
_commandTypeYY 
=YY 
commandTypeYY &
;YY& '
_commandTextZZ 
=ZZ 
commandTextZZ &
;ZZ& '
_parameters[[ 
=[[ 

parameters[[ $
;[[$ %
}\\ 	
}]] 
}^^ º
HC:\Projects\SqlServerAdoNet\SqlServerAdoNet\Models\InClauseProperties.cs
	namespace 	
	StatKings
 
. 
SqlServerAdoNet #
{ 
public		 

class		 
InClauseProperties		 #
{

 
public 
InClauseProperties !
(! "
)" #
{ 	

Parameters 
= 
new 
List !
<! "
IDbDataParameter" 2
>2 3
(3 4
)4 5
;5 6
} 	
public 
string 
Query 
{ 
get !
;! "
set# &
;& '
}( )
public 
IEnumerable 
< 
IDbDataParameter +
>+ ,

Parameters- 7
{8 9
get: =
;= >
set? B
;B C
}D E
} 
} Õ
FC:\Projects\SqlServerAdoNet\SqlServerAdoNet\Models\InsertProperties.cs
	namespace 	
	StatKings
 
. 
SqlServerAdoNet #
{ 
internal		 
class		 
InsertProperties		 #
{

 
public 
InsertProperties 
(  
)  !
{" #

Parameters$ .
=/ 0
new1 4
List5 9
<9 :
IDbDataParameter: J
>J K
(K L
)L M
;M N
}O P
public 
string 
Columns 
{ 
get  #
;# $
set% (
;( )
}* +
public 
string 
Values 
{ 
get "
;" #
set$ '
;' (
}) *
public 
List 
< 
IDbDataParameter $
>$ %

Parameters& 0
{1 2
get3 6
;6 7
set8 ;
;; <
}= >
} 
} ¡
?C:\Projects\SqlServerAdoNet\SqlServerAdoNet\Models\TableName.cs
	namespace 	
	StatKings
 
. 
SqlServerAdoNet #
{ 
public 

class 
	TableName 
{ 
public 
string 
Name 
{ 
get  
;  !
set" %
;% &
}' (
public 
string 
Schema 
{ 
get "
;" #
set$ '
;' (
}) *
} 
} ≥
FC:\Projects\SqlServerAdoNet\SqlServerAdoNet\Models\UpdateProperties.cs
	namespace 	
	StatKings
 
. 
SqlServerAdoNet #
{ 
internal

 
class

 
UpdateProperties

 #
{ 
public 
UpdateProperties 
(  
)  !
{" #

Parameters$ .
=/ 0
new1 4
List5 9
<9 :
IDbDataParameter: J
>J K
(K L
)L M
;M N
}O P
public 
string 
Columns 
{ 
get  #
;# $
set% (
;( )
}* +
public 
List 
< 
IDbDataParameter $
>$ %

Parameters& 0
{1 2
get3 6
;6 7
set8 ;
;; <
}= >
} 
} ≤
EC:\Projects\SqlServerAdoNet\SqlServerAdoNet\Models\WhereProperties.cs
	namespace 	
	StatKings
 
. 
SqlServerAdoNet #
{ 
internal

 
class

 
WhereProperties

 "
{ 
public 
WhereProperties 
( 
)  
{! "

Parameters# -
=. /
new0 3
List4 8
<8 9
IDbDataParameter9 I
>I J
(J K
)K L
;L M
}N O
public 
string 
	Condition 
{  !
get" %
;% &
set' *
;* +
}, -
public 
List 
< 
IDbDataParameter $
>$ %

Parameters& 0
{1 2
get3 6
;6 7
set8 ;
;; <
}= >
} 
} ì
FC:\Projects\SqlServerAdoNet\SqlServerAdoNet\Properties\AssemblyInfo.cs
[ 
assembly 	
:	 

AssemblyTitle 
( 
$str *
)* +
]+ ,
[		 
assembly		 	
:			 

AssemblyDescription		 
(		 
$str		 !
)		! "
]		" #
[

 
assembly

 	
:

	 
!
AssemblyConfiguration

  
(

  !
$str

! #
)

# $
]

$ %
[ 
assembly 	
:	 

AssemblyCompany 
( 
$str 
) 
] 
[ 
assembly 	
:	 

AssemblyProduct 
( 
$str ,
), -
]- .
[ 
assembly 	
:	 

AssemblyCopyright 
( 
$str 0
)0 1
]1 2
[ 
assembly 	
:	 

AssemblyTrademark 
( 
$str 
)  
]  !
[ 
assembly 	
:	 

AssemblyCulture 
( 
$str 
) 
] 
[ 
assembly 	
:	 


ComVisible 
( 
false 
) 
] 
[ 
assembly 	
:	 

Guid 
( 
$str 6
)6 7
]7 8
[## 
assembly## 	
:##	 

AssemblyVersion## 
(## 
$str## $
)##$ %
]##% &
[$$ 
assembly$$ 	
:$$	 

AssemblyFileVersion$$ 
($$ 
$str$$ (
)$$( )
]$$) *
[&& 
assembly&& 	
:&&	 

InternalsVisibleTo&& 
(&& 
$str&& C
)&&C D
]&&D E
['' 
assembly'' 	
:''	 

InternalsVisibleTo'' 
('' 
$str'' J
)''J K
]''K Lü≠
8C:\Projects\SqlServerAdoNet\SqlServerAdoNet\SqlRunner.cs
	namespace		 	
	StatKings		
 
.		 
SqlServerAdoNet		 #
{

 
public 

class 
	SqlRunner 
: 

ISqlRunner '
{ 
private 
readonly 
IUnitOfWork $
_unitOfWork% 0
;0 1
public 
	SqlRunner 
( 
IUnitOfWork $

unitOfWork% /
)/ 0
{ 	
if 
( 

unitOfWork 
== 
null "
)" #
{ 
throw 
new !
ArgumentNullException /
(/ 0
nameof0 6
(6 7

unitOfWork7 A
)A B
)B C
;C D
} 
_unitOfWork 
= 

unitOfWork $
;$ %
} 	
public## 
void## 
ExecuteNonQuery## #
(### $
CommandSettings##$ 3
commandSettings##4 C
)##C D
{$$ 	

IDbCommand%% 
cmd%% 
=%% 
CreateCommand%% *
(%%* +
commandSettings%%+ :
)%%: ;
;%%; <
try&& 
{'' 
cmd(( 
.(( 
ExecuteNonQuery(( #
(((# $
)(($ %
;((% &
SetOutputParameters)) #
())# $
cmd))$ '
,))' (
commandSettings))) 8
.))8 9

Parameters))9 C
)))C D
;))D E
}** 
catch++ 
(++ 
	Exception++ 
ex++ 
)++  
{,, 
throw-- 
HandleException-- %
(--% &
cmd--& )
,--) *
ex--+ -
)--- .
;--. /
}.. 
finally// 
{00 
if11 
(11 
cmd11 
!=11 
null11 
)11  
cmd11! $
.11$ %
Dispose11% ,
(11, -
)11- .
;11. /
}22 
}33 	
public:: 
object:: 
ExecuteScalar:: #
(::# $
CommandSettings::$ 3
commandSettings::4 C
)::C D
{;; 	

IDbCommand<< 
cmd<< 
=<< 
CreateCommand<< *
(<<* +
commandSettings<<+ :
)<<: ;
;<<; <
try== 
{>> 
var?? 
scalar?? 
=?? 
cmd??  
.??  !
ExecuteScalar??! .
(??. /
)??/ 0
;??0 1
SetOutputParameters@@ #
(@@# $
cmd@@$ '
,@@' (
commandSettings@@) 8
.@@8 9

Parameters@@9 C
)@@C D
;@@D E
returnAA 
scalarAA 
;AA 
}BB 
catchCC 
(CC 
	ExceptionCC 
exCC 
)CC  
{DD 
throwEE 
HandleExceptionEE %
(EE% &
cmdEE& )
,EE) *
exEE+ -
)EE- .
;EE. /
}FF 
finallyGG 
{HH 
ifII 
(II 
cmdII 
!=II 
nullII 
)II  
cmdII! $
.II$ %
DisposeII% ,
(II, -
)II- .
;II. /
}JJ 
}KK 	
publicSS 
IEnumerableSS 
<SS 
TSS 
>SS 
ExecuteReaderSS +
<SS+ ,
TSS, -
>SS- .
(SS. /
CommandSettingsSS/ >
commandSettingsSS? N
)SSN O
{TT 	

IDbCommandUU 
cmdUU 
=UU 
CreateCommandUU *
(UU* +
commandSettingsUU+ :
)UU: ;
;UU; <
tryVV 
{WW 
IEnumerableXX 
<XX 
TXX 
>XX 
resultsXX &
;XX& '
usingYY 
(YY 
varYY 
readerYY !
=YY" #
cmdYY$ '
.YY' (
ExecuteReaderYY( 5
(YY5 6
)YY6 7
)YY7 8
{ZZ 
results[[ 
=[[ 
	MapToList[[ '
<[[' (
T[[( )
>[[) *
([[* +
reader[[+ 1
)[[1 2
;[[2 3
}\\ 
SetOutputParameters]] #
(]]# $
cmd]]$ '
,]]' (
commandSettings]]) 8
.]]8 9

Parameters]]9 C
)]]C D
;]]D E
return^^ 
results^^ 
;^^ 
}__ 
catch`` 
(`` 
	Exception`` 
ex`` 
)``  
{aa 
throwbb 
HandleExceptionbb %
(bb% &
cmdbb& )
,bb) *
exbb+ -
)bb- .
;bb. /
}cc 
finallydd 
{ee 
ifff 
(ff 
cmdff 
!=ff 
nullff 
)ff  
cmdff! $
.ff$ %
Disposeff% ,
(ff, -
)ff- .
;ff. /
}gg 
}hh 	
publicpp 
Tpp 
ExecuteReaderFirstpp #
<pp# $
Tpp$ %
>pp% &
(pp& '
CommandSettingspp' 6
commandSettingspp7 F
)ppF G
{qq 	
returnrr 
ExecuteReaderrr  
<rr  !
Trr! "
>rr" #
(rr# $
commandSettingsrr$ 3
)rr3 4
.rr4 5
FirstOrDefaultrr5 C
(rrC D
)rrD E
;rrE F
}ss 	
public{{ 
T{{ 
Get{{ 
<{{ 
T{{ 
>{{ 
({{ 
params{{ 
object{{ %
[{{% &
]{{& '
primaryKeyValues{{( 8
){{8 9
{|| 	
var}} 
builder}} 
=}} 
new}} 
QueryBuilder}} *
<}}* +
T}}+ ,
>}}, -
(}}- .
	QueryType}}. 7
.}}7 8
Select}}8 >
)}}> ?
;}}? @
builder~~ 
.~~ 
SetPrimaryKeyValues~~ '
(~~' (
primaryKeyValues~~( 8
)~~8 9
;~~9 :
return 
ExecuteReaderFirst %
<% &
T& '
>' (
(( )
builder) 0
.0 1
MakeCommandSettings1 D
(D E
)E F
)F G
;G H
}
ÄÄ 	
public
áá 
IEnumerable
áá 
<
áá 
T
áá 
>
áá 
GetAll
áá $
<
áá$ %
T
áá% &
>
áá& '
(
áá' (
)
áá( )
{
àà 	
var
ââ 
builder
ââ 
=
ââ 
new
ââ 
QueryBuilder
ââ *
<
ââ* +
T
ââ+ ,
>
ââ, -
(
ââ- .
	QueryType
ââ. 7
.
ââ7 8
Select
ââ8 >
)
ââ> ?
;
ââ? @
return
ää 
ExecuteReader
ää  
<
ää  !
T
ää! "
>
ää" #
(
ää# $
builder
ää$ +
.
ää+ ,!
MakeCommandSettings
ää, ?
(
ää? @
)
ää@ A
)
ääA B
;
ääB C
}
ãã 	
public
íí 
void
íí 
Delete
íí 
<
íí 
T
íí 
>
íí 
(
íí 
params
íí $
object
íí% +
[
íí+ ,
]
íí, -
primaryKeyValues
íí. >
)
íí> ?
{
ìì 	
var
îî 
builder
îî 
=
îî 
new
îî 
QueryBuilder
îî *
<
îî* +
T
îî+ ,
>
îî, -
(
îî- .
	QueryType
îî. 7
.
îî7 8
Delete
îî8 >
)
îî> ?
;
îî? @
builder
ïï 
.
ïï !
SetPrimaryKeyValues
ïï '
(
ïï' (
primaryKeyValues
ïï( 8
)
ïï8 9
;
ïï9 :
ExecuteNonQuery
ññ 
(
ññ 
builder
ññ #
.
ññ# $!
MakeCommandSettings
ññ$ 7
(
ññ7 8
)
ññ8 9
)
ññ9 :
;
ññ: ;
}
óó 	
public
üü 
int
üü 
InsertForId
üü 
<
üü 
T
üü  
>
üü  !
(
üü! "
T
üü" #
entity
üü$ *
)
üü* +
{
†† 	
var
°° 
builder
°° 
=
°° 
new
°° 
QueryBuilder
°° *
<
°°* +
T
°°+ ,
>
°°, -
(
°°- .
	QueryType
°°. 7
.
°°7 8
Insert
°°8 >
)
°°> ?
;
°°? @
builder
¢¢ 
.
¢¢ 
SetEntityInstance
¢¢ %
(
¢¢% &
entity
¢¢& ,
)
¢¢, -
;
¢¢- .
var
££ 
scalar
££ 
=
££ 
ExecuteScalar
££ &
(
££& '
builder
££' .
.
££. /!
MakeCommandSettings
££/ B
(
££B C
)
££C D
)
££D E
;
££E F
return
§§ 
Convert
§§ 
.
§§ 
ToInt32
§§ "
(
§§" #
scalar
§§# )
)
§§) *
;
§§* +
}
•• 	
public
¨¨ 
void
¨¨ 
Insert
¨¨ 
<
¨¨ 
T
¨¨ 
>
¨¨ 
(
¨¨ 
T
¨¨ 
entity
¨¨  &
)
¨¨& '
{
≠≠ 	
var
ÆÆ 
builder
ÆÆ 
=
ÆÆ 
new
ÆÆ 
QueryBuilder
ÆÆ *
<
ÆÆ* +
T
ÆÆ+ ,
>
ÆÆ, -
(
ÆÆ- .
	QueryType
ÆÆ. 7
.
ÆÆ7 8
Insert
ÆÆ8 >
)
ÆÆ> ?
;
ÆÆ? @
builder
ØØ 
.
ØØ 
SetEntityInstance
ØØ %
(
ØØ% &
entity
ØØ& ,
)
ØØ, -
;
ØØ- .
ExecuteNonQuery
∞∞ 
(
∞∞ 
builder
∞∞ #
.
∞∞# $!
MakeCommandSettings
∞∞$ 7
(
∞∞7 8
)
∞∞8 9
)
∞∞9 :
;
∞∞: ;
}
±± 	
public
∏∏ 
void
∏∏ 
Update
∏∏ 
<
∏∏ 
T
∏∏ 
>
∏∏ 
(
∏∏ 
T
∏∏ 
entity
∏∏  &
)
∏∏& '
{
ππ 	
var
∫∫ 
builder
∫∫ 
=
∫∫ 
new
∫∫ 
QueryBuilder
∫∫ *
<
∫∫* +
T
∫∫+ ,
>
∫∫, -
(
∫∫- .
	QueryType
∫∫. 7
.
∫∫7 8
Update
∫∫8 >
)
∫∫> ?
;
∫∫? @
builder
ªª 
.
ªª 
SetEntityInstance
ªª %
(
ªª% &
entity
ªª& ,
)
ªª, -
;
ªª- .
ExecuteNonQuery
ºº 
(
ºº 
builder
ºº #
.
ºº# $!
MakeCommandSettings
ºº$ 7
(
ºº7 8
)
ºº8 9
)
ºº9 :
;
ºº: ;
}
ΩΩ 	
private
ƒƒ 

IDbCommand
ƒƒ 
CreateCommand
ƒƒ (
(
ƒƒ( )
CommandSettings
ƒƒ) 8
commandSettings
ƒƒ9 H
)
ƒƒH I
{
≈≈ 	
if
«« 
(
«« 
commandSettings
«« 
==
««  "
null
««# '
)
««' (
{
»» 
throw
…… 
new
…… #
ArgumentNullException
…… /
(
……/ 0
nameof
……0 6
(
……6 7
commandSettings
……7 F
)
……F G
,
……G H
$"
……I K
{
……K L
nameof
……L R
(
……R S
commandSettings
……S b
)
……b c
}
……c d
 is required.
……d q
"
……q r
)
……r s
;
……s t
}
   
var
ÕÕ 
cmd
ÕÕ 
=
ÕÕ 
_unitOfWork
ÕÕ !
.
ÕÕ! "
CreateCommand
ÕÕ" /
(
ÕÕ/ 0
)
ÕÕ0 1
;
ÕÕ1 2
cmd
ŒŒ 
.
ŒŒ 
CommandType
ŒŒ 
=
ŒŒ 
commandSettings
ŒŒ -
.
ŒŒ- .
CommandType
ŒŒ. 9
;
ŒŒ9 :
cmd
œœ 
.
œœ 
CommandText
œœ 
=
œœ 
commandSettings
œœ -
.
œœ- .
CommandText
œœ. 9
;
œœ9 :
foreach
““ 
(
““ 
var
““ 
prm
““ 
in
““ 
commandSettings
““  /
.
““/ 0

Parameters
““0 :
)
““: ;
{
”” 
cmd
‘‘ 
.
‘‘ 

Parameters
‘‘ 
.
‘‘ 
Add
‘‘ "
(
‘‘" #
prm
‘‘# &
)
‘‘& '
;
‘‘' (
}
’’ 
return
◊◊ 
cmd
◊◊ 
;
◊◊ 
}
ÿÿ 	
private
‡‡ 
DataException
‡‡ 
HandleException
‡‡ -
(
‡‡- .

IDbCommand
‡‡. 8
command
‡‡9 @
,
‡‡@ A
	Exception
‡‡B K
	exception
‡‡L U
)
‡‡U V
{
·· 	
var
‚‚ 
msg
‚‚ 
=
‚‚ 
new
‚‚ 
StringBuilder
‚‚ '
(
‚‚' (
)
‚‚( )
;
‚‚) *
msg
„„ 
.
„„ 

AppendLine
„„ 
(
„„ 
$str
„„ 7
)
„„7 8
;
„„8 9
msg
‰‰ 
.
‰‰ 

AppendLine
‰‰ 
(
‰‰ 
	exception
‰‰ $
.
‰‰$ %
ToString
‰‰% -
(
‰‰- .
)
‰‰. /
)
‰‰/ 0
;
‰‰0 1
msg
ÂÂ 
.
ÂÂ 

AppendLine
ÂÂ 
(
ÂÂ 
)
ÂÂ 
;
ÂÂ 
msg
ÊÊ 
.
ÊÊ 

AppendLine
ÊÊ 
(
ÊÊ 
$str
ÊÊ 0
)
ÊÊ0 1
;
ÊÊ1 2
msg
ÁÁ 
.
ÁÁ 

AppendLine
ÁÁ 
(
ÁÁ 
	exception
ÁÁ $
.
ÁÁ$ %
Message
ÁÁ% ,
)
ÁÁ, -
;
ÁÁ- .
msg
ËË 
.
ËË 

AppendLine
ËË 
(
ËË 
)
ËË 
;
ËË 
msg
ÈÈ 
.
ÈÈ 

AppendLine
ÈÈ 
(
ÈÈ 
$str
ÈÈ 4
)
ÈÈ4 5
;
ÈÈ5 6
msg
ÍÍ 
.
ÍÍ 

AppendLine
ÍÍ 
(
ÍÍ 
	exception
ÍÍ $
.
ÍÍ$ %

StackTrace
ÍÍ% /
)
ÍÍ/ 0
;
ÍÍ0 1
msg
ÎÎ 
.
ÎÎ 

AppendLine
ÎÎ 
(
ÎÎ 
)
ÎÎ 
;
ÎÎ 
var
ÌÌ 
inner
ÌÌ 
=
ÌÌ 
	exception
ÌÌ !
.
ÌÌ! "
InnerException
ÌÌ" 0
;
ÌÌ0 1
while
ÓÓ 
(
ÓÓ 
inner
ÓÓ 
!=
ÓÓ 
null
ÓÓ  
)
ÓÓ  !
{
ÔÔ 
msg
 
.
 

AppendLine
 
(
 
$str
 <
)
< =
;
= >
msg
ÒÒ 
.
ÒÒ 

AppendLine
ÒÒ 
(
ÒÒ 
inner
ÒÒ $
.
ÒÒ$ %
Message
ÒÒ% ,
)
ÒÒ, -
;
ÒÒ- .
msg
ÚÚ 
.
ÚÚ 

AppendLine
ÚÚ 
(
ÚÚ 
)
ÚÚ  
;
ÚÚ  !
inner
ÛÛ 
=
ÛÛ 
inner
ÛÛ 
.
ÛÛ 
InnerException
ÛÛ ,
;
ÛÛ, -
}
ÙÙ 
if
ˆˆ 
(
ˆˆ 
command
ˆˆ 
!=
ˆˆ 
null
ˆˆ 
&&
ˆˆ  "
!
ˆˆ# $
string
ˆˆ$ *
.
ˆˆ* + 
IsNullOrWhiteSpace
ˆˆ+ =
(
ˆˆ= >
command
ˆˆ> E
.
ˆˆE F
CommandText
ˆˆF Q
)
ˆˆQ R
)
ˆˆR S
{
˜˜ 
msg
¯¯ 
.
¯¯ 

AppendLine
¯¯ 
(
¯¯ 
$str
¯¯ 2
)
¯¯2 3
;
¯¯3 4
msg
˘˘ 
.
˘˘ 

AppendLine
˘˘ 
(
˘˘ 
command
˘˘ &
.
˘˘& '
CommandText
˘˘' 2
)
˘˘2 3
;
˘˘3 4
msg
˙˙ 
.
˙˙ 

AppendLine
˙˙ 
(
˙˙ 
)
˙˙  
;
˙˙  !
msg
˚˚ 
.
˚˚ 

AppendLine
˚˚ 
(
˚˚ 
$str
˚˚ 7
)
˚˚7 8
;
˚˚8 9
foreach
¸¸ 
(
¸¸ 
IDataParameter
¸¸ '
	parameter
¸¸( 1
in
¸¸2 4
command
¸¸5 <
.
¸¸< =

Parameters
¸¸= G
)
¸¸G H
{
˝˝ 
msg
˛˛ 
.
˛˛ 
AppendFormat
˛˛ $
(
˛˛$ %
$str
˛˛% /
,
˛˛/ 0
	parameter
˛˛1 :
.
˛˛: ;
ParameterName
˛˛; H
,
˛˛H I
	parameter
˛˛J S
.
˛˛S T
Value
˛˛T Y
)
˛˛Y Z
;
˛˛Z [
msg
ˇˇ 
.
ˇˇ 

AppendLine
ˇˇ "
(
ˇˇ" #
)
ˇˇ# $
;
ˇˇ$ %
}
ÄÄ 
}
ÅÅ 
var
ÑÑ 
de
ÑÑ 
=
ÑÑ 
new
ÑÑ 
DataException
ÑÑ &
(
ÑÑ& '
	exception
ÑÑ' 0
.
ÑÑ0 1
Message
ÑÑ1 8
)
ÑÑ8 9
;
ÑÑ9 :
de
ÖÖ 
.
ÖÖ 
Data
ÖÖ 
.
ÖÖ 
Add
ÖÖ 
(
ÖÖ 
$str
ÖÖ  
,
ÖÖ  !
msg
ÖÖ" %
.
ÖÖ% &
ToString
ÖÖ& .
(
ÖÖ. /
)
ÖÖ/ 0
)
ÖÖ0 1
;
ÖÖ1 2
return
ÜÜ 
de
ÜÜ 
;
ÜÜ 
}
áá 	
private
èè 
IEnumerable
èè 
<
èè 
T
èè 
>
èè 
	MapToList
èè (
<
èè( )
T
èè) *
>
èè* +
(
èè+ ,
IDataReader
èè, 7
reader
èè8 >
)
èè> ?
{
êê 	
var
íí 
items
íí 
=
íí 
new
íí 
List
íí  
<
íí  !
T
íí! "
>
íí" #
(
íí# $
)
íí$ %
;
íí% &
while
ìì 
(
ìì 
reader
ìì 
.
ìì 
Read
ìì 
(
ìì 
)
ìì  
)
ìì  !
{
îî 
items
ïï 
.
ïï 
Add
ïï 
(
ïï 
Map
ïï 
<
ïï 
T
ïï 
>
ïï  
(
ïï  !
reader
ïï! '
)
ïï' (
)
ïï( )
;
ïï) *
}
ññ 
return
óó 
items
óó 
;
óó 
}
òò 	
private
†† 
T
†† 
Map
†† 
<
†† 
T
†† 
>
†† 
(
†† 
IDataRecord
†† $
record
††% +
)
††+ ,
{
°° 	
var
¢¢ 
entity
¢¢ 
=
¢¢ 
	Activator
¢¢ "
.
¢¢" #
CreateInstance
¢¢# 1
<
¢¢1 2
T
¢¢2 3
>
¢¢3 4
(
¢¢4 5
)
¢¢5 6
;
¢¢6 7
var
££ 
propColNames
££ 
=
££ 
ReflectionHelper
££ /
.
££/ 0$
GetPropertyColumnNames
££0 F
<
££F G
T
££G H
>
££H I
(
££I J
)
££J K
;
££K L
for
¶¶ 
(
¶¶ 
var
¶¶ 
i
¶¶ 
=
¶¶ 
$num
¶¶ 
;
¶¶ 
i
¶¶ 
<
¶¶ 
record
¶¶  &
.
¶¶& '

FieldCount
¶¶' 1
;
¶¶1 2
i
¶¶3 4
++
¶¶4 6
)
¶¶6 7
{
ßß 
var
®® 

recordName
®® 
=
®®  
record
®®! '
.
®®' (
GetName
®®( /
(
®®/ 0
i
®®0 1
)
®®1 2
;
®®2 3
var
©© 
name
©© 
=
©© 
propColNames
©© '
.
©©' (
First
©©( -
(
©©- .
x
©©. /
=>
©©0 2
x
©©3 4
.
©©4 5
Value
©©5 :
==
©©; =

recordName
©©> H
)
©©H I
.
©©I J
Key
©©J M
;
©©M N
var
¨¨ 
prop
¨¨ 
=
¨¨ 
ReflectionHelper
¨¨ +
.
¨¨+ ,
GetProperty
¨¨, 7
<
¨¨7 8
T
¨¨8 9
>
¨¨9 :
(
¨¨: ;
name
¨¨; ?
)
¨¨? @
;
¨¨@ A
if
≠≠ 
(
≠≠ 
prop
≠≠ 
==
≠≠ 
null
≠≠  
)
≠≠  !
continue
≠≠" *
;
≠≠* +
var
∞∞ 
value
∞∞ 
=
∞∞ 
record
∞∞ "
.
∞∞" #
GetValue
∞∞# +
(
∞∞+ ,
i
∞∞, -
)
∞∞- .
;
∞∞. /
if
±± 
(
±± 
value
±± 
==
±± 
DBNull
±± #
.
±±# $
Value
±±$ )
)
±±) *
continue
±±+ 3
;
±±3 4
prop
¥¥ 
.
¥¥ 
SetValue
¥¥ 
(
¥¥ 
entity
¥¥ $
,
¥¥$ %
value
¥¥& +
)
¥¥+ ,
;
¥¥, -
}
µµ 
return
∑∑ 
entity
∑∑ 
;
∑∑ 
}
∏∏ 	
private
øø 
void
øø !
SetOutputParameters
øø (
(
øø( )

IDbCommand
øø) 3
command
øø4 ;
,
øø; <
IEnumerable
øø= H
<
øøH I
IDbDataParameter
øøI Y
>
øøY Z

parameters
øø[ e
)
øøe f
{
¿¿ 	
if
¡¡ 
(
¡¡ 

parameters
¡¡ 
!=
¡¡ 
null
¡¡ "
)
¡¡" #
{
¬¬ 
foreach
√√ 
(
√√ 
var
√√ 
prm
√√  
in
√√! #

parameters
√√$ .
)
√√. /
{
ƒƒ 
if
≈≈ 
(
≈≈ 
prm
≈≈ 
.
≈≈ 
	Direction
≈≈ %
!=
≈≈& ( 
ParameterDirection
≈≈) ;
.
≈≈; <
Input
≈≈< A
)
≈≈A B
{
∆∆ 
prm
«« 
.
«« 
Value
«« !
=
««" #
(
««$ %
(
««% &
SqlParameter
««& 2
)
««2 3
command
««3 :
.
««: ;

Parameters
««; E
[
««E F
prm
««F I
.
««I J
ParameterName
««J W
]
««W X
)
««X Y
.
««Y Z
Value
««Z _
;
««_ `
}
»» 
}
…… 
}
   
}
ÀÀ 	
}
ÃÃ 
}ÕÕ ß3
9C:\Projects\SqlServerAdoNet\SqlServerAdoNet\UnitOfWork.cs
	namespace 	
	StatKings
 
. 
SqlServerAdoNet #
{ 
public 

sealed 
class 

UnitOfWork "
:# $
IUnitOfWork% 0
{ 
public 
static 
IUnitOfWork !
Create" (
(( )
string) /
connectionString0 @
)@ A
{ 	
if 
( 
string 
. 
IsNullOrWhiteSpace )
() *
connectionString* :
): ;
); <
{ 
throw 
new 
ArgumentException +
(+ ,
$str, N
)N O
;O P
} 
var 
provider 
= 
DbProviderFactories .
.. /

GetFactory/ 9
(9 :
$str: Q
)Q R
;R S
var 

connection 
= 
provider %
.% &
CreateConnection& 6
(6 7
)7 8
;8 9
try 
{ 

connection 
. 
ConnectionString +
=, -
connectionString. >
;> ?

connection 
. 
Open 
(  
)  !
;! "
} 
catch 
( 
	Exception 
ex 
)  
{ 
var   
message   
=   
$str   m
;  m n
throw!! 
new!! 
DataException!! '
(!!' (
string!!( .
.!!. /
Format!!/ 5
(!!5 6
message!!6 =
,!!= >
connectionString!!? O
)!!O P
,!!P Q
ex!!R T
)!!T U
;!!U V
}"" 
return$$ 
new$$ 

UnitOfWork$$ !
($$! "

connection$$" ,
)$$, -
;$$- .
}%% 	
private'' 
IDbConnection'' 
_connection'' )
;'') *
private(( 
IDbTransaction(( 
_transaction(( +
;((+ ,
private-- 

UnitOfWork-- 
(-- 
IDbConnection-- (

connection--) 3
)--3 4
{.. 	
_connection// 
=// 

connection// $
;//$ %
}00 	
public66 

IDbCommand66 
CreateCommand66 '
(66' (
)66( )
{77 	
var88 
cmd88 
=88 
_connection88 !
.88! "
CreateCommand88" /
(88/ 0
)880 1
;881 2
cmd99 
.99 
Transaction99 
=99 
_transaction99 *
;99* +
return:: 
cmd:: 
;:: 
};; 	
public@@ 
void@@ 
BeginTransaction@@ $
(@@$ %
)@@% &
{AA 	
ifBB 
(BB 
_transactionBB 
!=BB 
nullBB  $
)BB$ %
{CC 
throwDD 
newDD %
InvalidOperationExceptionDD 3
(DD3 4
$strDD4 ]
)DD] ^
;DD^ _
}EE 
tryGG 
{HH 
_transactionII 
=II 
_connectionII *
.II* +
BeginTransactionII+ ;
(II; <
)II< =
;II= >
}JJ 
catchKK 
(KK 
	ExceptionKK 
exKK 
)KK  
{LL 
throwMM 
newMM %
InvalidOperationExceptionMM 3
(MM3 4
$str	MM4 Ä
,
MMÄ Å
ex
MMÇ Ñ
)
MMÑ Ö
;
MMÖ Ü
}NN 
}OO 	
publicTT 
voidTT 
CommitTT 
(TT 
)TT 
{UU 	
ifVV 
(VV 
_transactionVV 
==VV 
nullVV  $
)VV$ %
{WW 
throwXX 
newXX %
InvalidOperationExceptionXX 3
(XX3 4
$str	XX4 É
)
XXÉ Ñ
;
XXÑ Ö
}YY 
try[[ 
{\\ 
_transaction]] 
.]] 
Commit]] #
(]]# $
)]]$ %
;]]% &
}^^ 
catch__ 
(__ 
	Exception__ 
ex__ 
)__  
{`` 
throwaa 
newaa %
InvalidOperationExceptionaa 3
(aa3 4
$str	aa4 ™
,
aa™ ´
ex
aa¨ Æ
)
aaÆ Ø
;
aaØ ∞
}bb 
_transactiondd 
=dd 
nulldd 
;dd  
}ee 	
publicjj 
voidjj 
Rollbackjj 
(jj 
)jj 
{kk 	
ifll 
(ll 
_transactionll 
==ll 
nullll  $
)ll$ %
{mm 
thrownn 
newnn %
InvalidOperationExceptionnn 3
(nn3 4
$str	nn4 É
)
nnÉ Ñ
;
nnÑ Ö
}oo 
tryqq 
{rr 
_transactionss 
.ss 
Rollbackss %
(ss% &
)ss& '
;ss' (
}tt 
catchuu 
(uu 
	Exceptionuu 
exuu 
)uu  
{vv 
throwww 
newww %
InvalidOperationExceptionww 3
(ww3 4
$str	ww4 ¨
,
ww¨ ≠
ex
wwÆ ∞
)
ww∞ ±
;
ww± ≤
}xx 
_transactionzz 
=zz 
nullzz 
;zz  
}{{ 	
public
ÄÄ 
void
ÄÄ 
Dispose
ÄÄ 
(
ÄÄ 
)
ÄÄ 
{
ÅÅ 	
if
ÇÇ 
(
ÇÇ 
_transaction
ÇÇ 
!=
ÇÇ 
null
ÇÇ  $
)
ÇÇ$ %
{
ÉÉ 
_transaction
ÖÖ 
.
ÖÖ 
Rollback
ÖÖ %
(
ÖÖ% &
)
ÖÖ& '
;
ÖÖ' (
_transaction
ÜÜ 
=
ÜÜ 
null
ÜÜ #
;
ÜÜ# $
}
áá 
if
ââ 
(
ââ 
_connection
ââ 
!=
ââ 
null
ââ #
)
ââ# $
{
ää 
_connection
ãã 
.
ãã 
Close
ãã !
(
ãã! "
)
ãã" #
;
ãã# $
_connection
åå 
=
åå 
null
åå "
;
åå" #
}
çç 
}
éé 	
}
èè 
}êê 